<% provide(:title, "Nuevos socios") %>
<%= render "nav", current_page: :subscriptions %>

<% if current_user.admin? %>
  <div class="card text-white bg-secondary mb-3">
    <div class="card-header">
      Importar un CSV de HelloAsso.
    </div>
    <div class="card-body">
      <%= simple_form_for :import_form, url: subscriptions_review_csv_path, html: { class: "row" } do |f| %>
        <div class="col-12 col-md-10">
          <%= f.input :csvfile, as: :file, input_html: { accept: ".csv" }, label: "Seleccionar un fichero" %>
        </div>
        <div class="col-12 col-md-2">
          <%= f.button :submit, class: "submit-button", disabled: true %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<%= render "shared/compact_table", headers: ["Apellido", "Nombre", "WCA ID", "Email", "Pagado el", "", ""] do %>
  <% @subscriptions.each do |subscription| %>
    <tr>
      <td><%= subscription.firstname %></td>
      <td><%= subscription.name %></td>
      <td><%= link_to_wca_profile(subscription.wca_id) %></td>
      <td><%= subscription.email %></td>
      <td><%= subscription.payed_at %></td>
      <td><%= link_to "Recibo", subscription.receipt_url %></td>
      <td>
        <% if current_user.admin? %>
          <%= link_to fa_icon("trash"), subscription, method: :delete, data: { confirm: '¿Estás seguro?' }, class: "btn btn-danger btn-sm" %>
        <% end %>
      </td>
    </tr>
  <% end %>
<% end %>
</div>
<script>
  $(".custom-file-input").change(function (e) {
    $(".custom-file-label").text(e.target.value.replace("C:\\fakepath\\", ""));
    $(".submit-button").prop("disabled", false);
  });
</script>
